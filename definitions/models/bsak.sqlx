config {
  type: "incremental",
  schema: "mart",
  name: "bsak",
  tags: ["ap", "bsak"],
  bigquery: { partitionBy: "PostDate" }  
}

WITH src AS (
  SELECT *
  FROM ${ref("bsak_staging")}
  ${when(incremental(), `
    WHERE SAS_IMPORT_DATETIME >
      (SELECT IFNULL(MAX(SAS_IMPORT_DATETIME), DATETIME '1900-01-01 00:00:00')
       FROM ${self()})
  `)}
)
SELECT * FROM src
